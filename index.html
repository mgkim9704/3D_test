<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title> Final project </title>
	<script src="three.min.js"></script>
	<script>
		var width, height, renderer, scene, camera;
		function init() {
			width = window.innerWidth;
			height = window.innerHeight;
			
			renderer = new THREE.WebGLRenderer();
			renderer.setSize(width, height);
			document.body.appendChild(renderer.domElement);
			
			scene = new THREE.Scene();
			
			var angle=45;
			var aspect=width/height;
			var near=0.1;
			var far=10000;
			camera = new THREE.PerspectiveCamera(angle, aspect, near, far);
			camera.position.set(0,0,1000);
			
			var light = new THREE.PointLight();
			light.position.set(1000,1000,1000);
			scene.add(light);
		}
		
		function loop() {
			list.forEach(function (item){
				item.rotation.x += 0.02;
				item.rotation.y += 0.02;
				item.rotation.z += 0.02;
			});
			
			renderer.render(scene, camera);
			requestAnimationFrame(loop);
		}
		
		window.addEventListener('load', function() {
			
			init();
			
			var random = function(limit){
				return Math.round(Math.random() * limit);
			};
			
			list=[];
			for (var i=0; i<50; i++) {
				var geometry = new THREE.CubeGeometry(50,50,50);
				var material = new THREE.MeshLambertMaterial({
					color: 0xff0000
				});
			
				var mesh = new THREE.Mesh(geometry, material);
				mesh.position.set(random(3000)-1500,0,random(3000)-1500);
				scene.add(mesh);
				list.push(mesh);
			}
			
			requestAnimationFrame(loop);
		});
	</script>

		 
</head>
<style>
	* { margin:0;padding:0; }
	body {overflow:hidden;}
</style>
<body>		
	<h1> Final project </h1>
	<p> Open an audio file from your local folder and play/stop it by clicking the buttons.</p>
	
	<input id="fileChooseInput" type="file"></input>
	<button onclick="playSound(myAudioBuffer)">Play</button>
	<button onclick="stopSound()">Stop</button>	  
	<script>	
	var context;
	var myAudioBuffer = null;
	// initialization
	window.onload=function(){
		var control = document.getElementById("fileChooseInput");
		control.addEventListener("change", fileChanged, false);
		window.AudioContext = window.AudioContext || window.webkitAudioContext;
		context = new AudioContext();
	}
	// 
	function fileChanged(e){
		var file = e.target.files[0];
		var fileReader = new FileReader();
		fileReader.onload = fileLoaded;
		fileReader.readAsArrayBuffer(file);
	}
	function fileLoaded(e){
	    context.decodeAudioData(e.target.result, function(buffer) {
	      myAudioBuffer = buffer;
	    });
	    console.log("File has been loaded.")
	}
	var source = null;
	function playSound(anybuffer) {
	  source = context.createBufferSource();
	  source.buffer = anybuffer;
	  source.connect(context.destination);
	  source.start();
	}
	function stopSound() {
	  if (source) {
	    source.stop();
	  }
	}	   	
	</script>
</body>
</html>
